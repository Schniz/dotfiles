#!/usr/bin/env bun
// vim: ft=javascript

// prtitle
// copies the current PR title and URL to the clipboard in rich text format (RTF) and markdown format

import { $ } from "bun";

const {
  additions,
  deletions,
  url,
  number,
  title,
  isDraft,
  headRepositoryOwner: { login: owner },
  headRepository: { name: repo },
} = await $`gh pr view --json title,number,url,additions,deletions,headRepository,headRepositoryOwner,isDraft`.json();

const text = `${owner}/${repo} <b>#${number} ${title}</b>`;
const stats = `+${additions} -${deletions}`;
const icon = isDraft ? ":pr-draft:" : ":pr:";

const clipboardContent = `${icon} <a href=${JSON.stringify(url)}>${text}</a> ${stats}`;

await $`(~/Code/Schniz/devek/target/debug/devek ${clipboardContent}) || (bunx devek ${clipboardContent})`;
